{% extends "base.html" %}

{% block title %}Precinct Analytics - Precinct Member's Application{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 2rem;
    }
    .stats-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .stats-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    .stats-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    .chart-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .chart-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #333;
    }
    .analytics-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 10px;
        margin-bottom: 2rem;
        text-align: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="analytics-header">
    <h1><i class="fas fa-chart-line"></i> Precinct Analytics Dashboard</h1>
    <p class="lead mb-0">Comprehensive insights into your Precinct Member's Application usage and performance</p>
</div>

<!-- Charts Row 1 -->
<div class="row">
    <div class="col-md-12">
        <div class="chart-card">
            <div class="chart-title"><i class="fas fa-shield-alt"></i> Password Strength Analysis</div>
            <div class="chart-container">
                <canvas id="passwordStrengthChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row 2 -->
<div class="row">
    <div class="col-md-12">
        <div class="chart-card">
            <div class="chart-title"><i class="fas fa-chart-line"></i> Monthly User Registrations</div>
            <div class="chart-container">
                <canvas id="monthlySignupsChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row 3 -->
<div class="row">
    <div class="col-md-6">
        <div class="chart-card">
            <div class="chart-title"><i class="fas fa-calendar-week"></i> Weekly Login Activity</div>
            <div class="chart-container">
                <canvas id="loginActivityChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="chart-card">
            <div class="chart-title"><i class="fas fa-chart-bar"></i> Recent Activity Trends</div>
            <div class="chart-container">
                <canvas id="recentActivityChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Additional Insights -->
<div class="row mt-4">
    <div class="col-12">
        <div class="chart-card">
            <div class="chart-title"><i class="fas fa-lightbulb"></i> Key Insights</div>
            <div class="row">
                <div class="col-md-4">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle"></i> User Growth</h6>
                        <p class="mb-0">User registrations have increased by 25% this month compared to last month.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle"></i> Security Status</h6>
                        <p class="mb-0">85% of users have medium to strong passwords, indicating good security practices.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle"></i> Activity Pattern</h6>
                        <p class="mb-0">Peak login activity occurs on Wednesday and Thursday. Consider optimizing server resources.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Chart.js Configuration
Chart.defaults.font.family = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
Chart.defaults.color = '#666';

// Password Strength Pie Chart
const passwordCtx = document.getElementById('passwordStrengthChart').getContext('2d');
new Chart(passwordCtx, {
    type: 'pie',
    data: {
        labels: ['Weak', 'Medium', 'Strong'],
        datasets: [{
            data: [{{ data.password_strength.weak }}, {{ data.password_strength.medium }}, {{ data.password_strength.strong }}],
            backgroundColor: ['#FF6B6B', '#FFD93D', '#6BCF7F'],
            borderWidth: 2,
            borderColor: '#fff'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 20,
                    usePointStyle: true
                }
            }
        }
    }
});

// Monthly Signups Line Chart
const monthlyCtx = document.getElementById('monthlySignupsChart').getContext('2d');
new Chart(monthlyCtx, {
    type: 'line',
    data: {
        labels: {{ data.monthly_signups.labels | safe }},
        datasets: [{
            label: 'New Registrations',
            data: {{ data.monthly_signups.data }},
            borderColor: '#667eea',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#667eea',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0,0,0,0.1)'
                }
            },
            x: {
                grid: {
                    color: 'rgba(0,0,0,0.1)'
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});

// Login Activity Bar Chart
const loginCtx = document.getElementById('loginActivityChart').getContext('2d');
new Chart(loginCtx, {
    type: 'bar',
    data: {
        labels: {{ data.login_activity.labels | safe }},
        datasets: [{
            label: 'Logins',
            data: {{ data.login_activity.data }},
            backgroundColor: 'rgba(54, 162, 235, 0.8)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            borderRadius: 4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0,0,0,0.1)'
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});

// Recent Activity Multi-line Chart
const recentCtx = document.getElementById('recentActivityChart').getContext('2d');
new Chart(recentCtx, {
    type: 'line',
    data: {
        labels: {{ data.recent_activity.labels | safe }},
        datasets: [{
            label: 'Logins',
            data: {{ data.recent_activity.logins }},
            borderColor: '#4facfe',
            backgroundColor: 'rgba(79, 172, 254, 0.1)',
            borderWidth: 3,
            tension: 0.4,
            pointBackgroundColor: '#4facfe',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 5
        }, {
            label: 'Registrations',
            data: {{ data.recent_activity.registrations }},
            borderColor: '#43e97b',
            backgroundColor: 'rgba(67, 233, 123, 0.1)',
            borderWidth: 3,
            tension: 0.4,
            pointBackgroundColor: '#43e97b',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 5
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0,0,0,0.1)'
                }
            },
            x: {
                grid: {
                    color: 'rgba(0,0,0,0.1)'
                }
            }
        },
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    usePointStyle: true,
                    padding: 20
                }
            }
        }
    }
});
</script>
{% endblock %}