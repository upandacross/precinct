#!/usr/bin/env python3
"""
Test script to verify Flask-Admin forms work without WTForms errors.
"""
import sys
import os
from main import create_app
from models import db, User

def test_admin_forms():
    """Test that Flask-Admin forms can be created without errors."""
    print("Testing Flask-Admin forms...")
    
    app = create_app()
    with app.app_context():
        try:
            # Try to get the admin instance
            from flask_admin import Admin
            admin = Admin()
            
            # Import the view
            from main import UserModelView
            
            # Create the view
            view = UserModelView(User, db.session, name='Users')
            
            # Try to create the form (this is where the error would occur)
            form_class = view.get_create_form()
            form = form_class()
            
            print("✅ SUCCESS: Flask-Admin forms created without errors!")
            print(f"Form fields: {list(form._fields.keys())}")
            
            return True
            
        except Exception as e:
            import traceback
            print(f"❌ ERROR: {str(e)}")
            print("Full traceback:")
            traceback.print_exc()
            return False

if __name__ == "__main__":
    success = test_admin_forms()
    sys.exit(0 if success else 1)